# Position Calibration

This contains the code necessary for calibrating the grasper position. It also contains the data files resulting from this calibration process. 

### Files

The `position_calibration_python_script.py` file is the python script that acts as the data logger for the calibration procedure and is the primary interface for the user.

The `data_analysis_script.py` file is the python script that can be used to analyze the data generated by `position_calibration_python_script.py`
    - It uses the file `psp.py` which contains a function `position_scatter_plotter` that generates a 3D scatter plot of the position data 

The folder `./position_calibration_setup` contains the file `position_calibration_setup.ino`. This file is the code for running the physical calibration process. It assumes that it is being run on a Teensy 4.0 microcontroller. 

The file `position_surface_fit.py` is a script that takes the data from `data_analysis_script.py` and uses it to generate an best fit equation that maps the encoder and force readings to a jaw position in mm. It is a work in progress.

The file `Test Notebook for Position Calibration.ipynb` is a Jupyter notebook file that is being used to help develop the other code. It is not important except as a development space. 

### Calibration Procedure
To get the data needed to calibrate the jaw position:

1. Ensure all the hardware is properly set up and powered on
2. Check the metadata generating function `generate_json_position` and its inputs in `position_calibration_python_script.py` to make sure that they are correct
3. Make sure that the correct COM port for the microcontroller is used. This value is found when initializing the serial port in `position_calibration_python_script.py`.
4. Upload the latest version of `position_calibration_setup.ino` to the microcontroller. If `position_calibration_setup.ino` has not changed and was the most recent script uploaded to the microcontroller, you can press the reset button to begin the script from the beginning.
5. When the indicator LED blinks three times, begin running `position_calibration_python_script.py`
6. Follow the prompts from the python script to run the calibration process
7. This should generate a CSV file in the `./Data Files` folder with the name `Position_Calibration_MM_DD_YYYY_X.csv`. The metadata for this csv file is added to `Motor_Controller_Grasper_Project.json` in the `./Calibration Setup` folder.
   - The *MM_XX_YYYY* in the file name is replaced with the month, day, and year that the position calibration is being run in that format
   - The *X* in the file name is replaced by the trial number of the calibration run for that day
